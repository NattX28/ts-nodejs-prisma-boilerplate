![License](https://img.shields.io/badge/license-MIT-blue.svg)
![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg)

# Boilerplate (Backend)

Boilerplate for full-stack REST API using Typescript, Express, Prisma(postgreSQL) with JWT Authentication and Refresh token via HTTPOnly Cookies

## 🧩 Overview

A scalable, production-ready boilerplate for building secure REST APIs using TypeScript, Express, and PostgreSQL via Prisma ORM. Comes with built-in JWT authentication, RBAC, logging, and developer-friendly defaults.

**Frontend:** Not included — you can integrate with any frontend framework (React, Vue, etc.)

## ✨ Features

- 🔐 **JWT Authentication** with access & refresh tokens (refresh token stored in httpOnly cookie)
- 🔒 **Role-based Access Control** (User, Moderator, Admin)
- 🛡️ **Security Features** (Helmet, CORS, Rate Limiting)
- ✅ **Input Validation** with Zod
- 📝 **Logging** with Winston
- 🗃️ **Database** with Prisma (PostgreSQL), Seed script + .env support
- 🚀 **Production Ready** with error handling and graceful shutdown

## 📁 Project structure

```bash
.
├── backend                      # Backend code (Express + TypeScript + Prisma)
│   ├── prisma                  # Prisma schema & migration files
│   │   ├── schema.prisma       # Main Prisma schema
│   │   ├── seeds/               # Folder for organized seeding
│   │   ├── seed.ts              # Actual seed script
│   │   └── migrations/          # Auto-generated by Prisma CLI
│   ├── src
│   │   ├── routes/v1/           # Route definitions (versioned)
│   │   ├── controllers/         # Handle request/response
│   │   ├── services/            # Business logic
│   │   ├── middlewares/         # Middlewares (auth, validation, error handler)
│   │   ├── helpers/             # Utility/helper functions
│   │   ├── types/               # Custom TypeScript types/interfaces
│   │   ├── utils/               # Common utility functions/classes/interfaces (e.g., ApiResponse)
│   │   └── configs/             # App configuration & environment loader
│   ├── app.ts                  # Express app instance
│   ├── index.ts                # App entry point (start server)
│   ├── .env.example            # Backend environment variable example
│   └── package.json            # Backend-specific dependencies & scripts
│
├── frontend                    # Frontend code (e.g., Vite + React)
│   └── .env.example            # Frontend environment variable example
│
├── .gitignore
├── README.md
└── package.json                # Root-level package.json (optional; e.g., if using workspaces)
```

## 🛠️ Tech Stack

**Backend:** TypeScript, Node.js, Express 5, Prisma ORM, PostgreSQL, Zod, Winston, tsx

## ⚙️ Installation

### 1. Clone project

```bash
git clone https://github.com/NattX28/ts-nodejs-prisma-boilerplate
```

### 2. Install dependencies

```bash
cd backend
npm install
```

### 3. Create .env and Setup

```bash
cp .env.example .env
```

Edit `.env` with your database connection and JWT secrets:

```env
NODE_ENV=development
PORT=5000
DATABASE_URL="postgresql://username:password@localhost:5432/mydb"
ACCESS_TOKEN_SECRET=your-super-secret-access-token-key-here
REFRESH_TOKEN_SECRET=your-super-secret-refresh-token-key-here
FRONTEND_URL=http://localhost:3000
```

### 4. Database Setup

```bash
# First time setup - create migration (this will auto-generate Prisma client)
npx prisma migrate dev --name "init"

# Seed database with test users (optional)
npm run db:seed
```

### 🌱 Database Seeding (Optional)

The seed script creates default users for development and testing. You can customize the default users by setting these environment variables in your `.env` file:

```env
# Database Seeding (Optional - for development)
ADMIN_EMAIL=admin@example.com
ADMIN_PASSWORD=admin123456
MODERATOR_EMAIL=moderator@example.com
MODERATOR_PASSWORD=moderator123456
USER_EMAIL=user@example.com
USER_PASSWORD=user123456
```

**Default Users Created:**

- **Admin**: Full system access
- **Moderator**: User + moderation permissions
- **User**: Basic user permissions

**Security Note:**

- ⚠️ **Never use default passwords in production**
- 🔒 **Always change default credentials in production environment**
- 🚫 **Consider disabling seeding in production** by checking `NODE_ENV`

To run seeding:

```bash
npm run db:seed
```

To skip seeding, simply don't run the seed command or remove the seed environment variables.

### 🧪 Run in Development

```bash
npm run dev
```

### 🛠 Build & Run in Production

```bash
npm run build
npm start
```

## 📬 API Endpoints

### Health Check

- ` GET: /api/v1/health` - Health check endpoint

### Authentication APIs

- ` POST: /api/v1/auth/register` - Register new user
- ` POST: /api/v1/auth/login` - Login user
- ` POST: /api/v1/auth/refresh` - Refresh access token
- ` POST: /api/v1/auth/logout` - Logout user
- ` POST: /api/v1/auth/logout-all` - Logout all devices
- ` PUT: /api/v1/auth/change-password` - Change password
- ` GET: /api/v1/auth/me` - Get current user profile

### User APIs

- ` GET: /api/v1/user` - get all users (Admin only)
- ` PUT: /api/v1/user/profile` - Update user profile
- ` DELETE: /api/v1/user/account` - Delete user account
- ` DELETE: /api/v1/user/:id` - Delete user by ID (Admin only)

## 🔀 Authentication Flow

1. **Registration/Login:** User provides credentials
2. **Token Generation:** Server generates access token (15mins) and refresh token (30d)
3. **Token Storage:** Refresh token stored as httpOnly cookie, access token returned in response
4. **API Access:** Include access token in Authorization header: `Bearer <access token>`
5. **Token Refresh:** When access token expires, use refresh endpoint with httpOnly cookie
6. **Logout:** Clear refresh token from database and cookie

## 🔐 Security Features

- **Password Hashing:** bcrypt with salt rounds
- **JWT Tokens:** Separate access and refresh tokens
- **HttpOnly Cookies:** Refresh tokens stored securely
- **Rate Limiting:** 60 requests per minute per IP
- **CORS:** Configurable origin whitelist
- **Helmet:** Security headers
- **Input Validation:** Zod schema validation
- **Error Handling:** Centralized error handling with logging

## 👤 Role-Based Access Control

- **USER:** Basic user permissions
- **MODERATOR:** User + moderation permission
- **ADMIN:** Full system access

Use middleware to protect routes

```typescript
// Require authentication
router.use(authenticateToken)

// Require admin role
router.get("/admin-only", requireAdmin, controller)

// Require moderator or admin
router.get("/mod-only", requireModeratorOrAdmin, controller)
```

## 🚀 Production Deployment

### 1. Environment Variables

```env
NODE_ENV=production
DATABASE_URL=your-production-database-url
ACCESS_TOKEN_SECRET=your-production-access-secret
REFRESH_TOKEN_SECRET=your-production-refresh-secret
FRONTEND_URL=https://your-frontend-domain.com
```

### 2. Build and Start

```bash
npm run build
npm start
```

### 🎬 Scripts

- `npm run dev` - Start development server with hot reload
- `npm run build` - Build for production
- `npm start` - Start production server
- `npm run prisma:generate` - Generate Prisma client
- `npm run migrate:dev` - Run database migrations in development mode
- `npm run migrate:prod` - Run database migrations in production mode
- `npm run db:seed` - Seed database with test data

## ⚠️ Error Handling

The API uses centralized error handling with appropriate HTTP status codes:

- `400` - Bad Request (validation errors)
- `401` - Unauthorized (authentication required)
- `403` - Forbidden (insufficient permissions)
- `404` - Not Found
- `409` - Conflict (resource already exists)
- `500` - Internal Server Error

## 📃 Logging

Winston logger with different levels:

- **Development:** Console + file logging
- **Production:** File logging only
- **Log Files:** `logs/errors.log`, `logs/combined.log`

## Database Migrations

Add new migration:

```bash
npx prisma migrate dev --name add_new_feature
```

Reset database:

```bash
npx prisma migrate reset
```

## Contributing

1.  Follow TypeScript and ESLint rules
2.  Use function-based approach (no classes)
3.  Add proper error handling
4.  Include input validation
5.  Add logging for important operations
6.  Update documentation

## 🙋‍♂️ Questions?

If you have any questions, feel free to open an issue or reach out on [GitHub Issues](https://github.com/NattX28/ts-nodejs-prisma-boilerplate/issues)
