![License](https://img.shields.io/badge/license-MIT-blue.svg)
![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg)

# Boilerplate (Backend)

Boilerplate for full-stack REST API using Typescript, Express, Prisma(postgreSQL) with JWT Authentication and Refresh token via HTTPOnly Cookies

## ğŸ§© Overview

A scalable, production-ready boilerplate for building secure REST APIs using TypeScript, Express, and PostgreSQL via Prisma ORM. Comes with built-in JWT authentication, RBAC, logging, and developer-friendly defaults.

**Frontend:** Not included â€” you can integrate with any frontend framework (React, Vue, etc.)

## âœ¨ Features

- ğŸ” **JWT Authentication** with access & refresh tokens (refresh token stored in httpOnly cookie)
- ğŸ”’ **Role-based Access Control** (User, Moderator, Admin)
- ğŸ›¡ï¸ **Security Features** (Helmet, CORS, Rate Limiting)
- âœ… **Input Validation** with Zod
- ğŸ“ **Logging** with Winston
- ğŸ—ƒï¸ **Database** with Prisma (PostgreSQL), Seed script + .env support
- ğŸš€ **Production Ready** with error handling and graceful shutdown

## ğŸ“ Project structure

```bash
.
â”œâ”€â”€ backend                      # Backend code (Express + TypeScript + Prisma)
â”‚   â”œâ”€â”€ prisma                  # Prisma schema & migration files
â”‚   â”‚   â”œâ”€â”€ schema.prisma       # Main Prisma schema
â”‚   â”‚   â”œâ”€â”€ seeds/               # Folder for organized seeding
â”‚   â”‚   â”œâ”€â”€ seed.ts              # Actual seed script
â”‚   â”‚   â””â”€â”€ migrations/          # Auto-generated by Prisma CLI
â”‚   â”œâ”€â”€ src
â”‚   â”‚   â”œâ”€â”€ routes/v1/           # Route definitions (versioned)
â”‚   â”‚   â”œâ”€â”€ controllers/         # Handle request/response
â”‚   â”‚   â”œâ”€â”€ services/            # Business logic
â”‚   â”‚   â”œâ”€â”€ middlewares/         # Middlewares (auth, validation, error handler)
â”‚   â”‚   â”œâ”€â”€ helpers/             # Utility/helper functions
â”‚   â”‚   â”œâ”€â”€ types/               # Custom TypeScript types/interfaces
â”‚   â”‚   â”œâ”€â”€ utils/               # Common utility functions/classes/interfaces (e.g., ApiResponse)
â”‚   â”‚   â””â”€â”€ configs/             # App configuration & environment loader
â”‚   â”œâ”€â”€ app.ts                  # Express app instance
â”‚   â”œâ”€â”€ index.ts                # App entry point (start server)
â”‚   â”œâ”€â”€ .env.example            # Backend environment variable example
â”‚   â””â”€â”€ package.json            # Backend-specific dependencies & scripts
â”‚
â”œâ”€â”€ frontend                    # Frontend code (e.g., Vite + React)
â”‚   â””â”€â”€ .env.example            # Frontend environment variable example
â”‚
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â””â”€â”€ package.json                # Root-level package.json (optional; e.g., if using workspaces)
```

## ğŸ› ï¸ Tech Stack

**Backend:** TypeScript, Node.js, Express 5, Prisma ORM, PostgreSQL, Zod, Winston, tsx

## âš™ï¸ Installation

### 1. Clone project

```bash
git clone https://github.com/NattX28/ts-nodejs-prisma-boilerplate
```

### 2. Install dependencies

```bash
cd backend
npm install
```

### 3. Create .env and Setup

```bash
cp .env.example .env
```

Edit `.env` with your database connection and JWT secrets:

```env
NODE_ENV=development
PORT=5000
DATABASE_URL="postgresql://username:password@localhost:5432/mydb"
ACCESS_TOKEN_SECRET=your-super-secret-access-token-key-here
REFRESH_TOKEN_SECRET=your-super-secret-refresh-token-key-here
FRONTEND_URL=http://localhost:3000
```

### 4. Database Setup

```bash
# First time setup - create migration (this will auto-generate Prisma client)
npx prisma migrate dev --name "init"

# Seed database with test users (optional)
npm run db:seed
```

### ğŸŒ± Database Seeding (Optional)

The seed script creates default users for development and testing. You can customize the default users by setting these environment variables in your `.env` file:

```env
# Database Seeding (Optional - for development)
ADMIN_EMAIL=admin@example.com
ADMIN_PASSWORD=admin123456
MODERATOR_EMAIL=moderator@example.com
MODERATOR_PASSWORD=moderator123456
USER_EMAIL=user@example.com
USER_PASSWORD=user123456
```

**Default Users Created:**

- **Admin**: Full system access
- **Moderator**: User + moderation permissions
- **User**: Basic user permissions

**Security Note:**

- âš ï¸ **Never use default passwords in production**
- ğŸ”’ **Always change default credentials in production environment**
- ğŸš« **Consider disabling seeding in production** by checking `NODE_ENV`

To run seeding:

```bash
npm run db:seed
```

To skip seeding, simply don't run the seed command or remove the seed environment variables.

### ğŸ§ª Run in Development

```bash
npm run dev
```

### ğŸ›  Build & Run in Production

```bash
npm run build
npm start
```

## ğŸ“¬ API Endpoints

### Health Check

- ` GET: /api/v1/health` - Health check endpoint

### Authentication APIs

- ` POST: /api/v1/auth/register` - Register new user
- ` POST: /api/v1/auth/login` - Login user
- ` POST: /api/v1/auth/refresh` - Refresh access token
- ` POST: /api/v1/auth/logout` - Logout user
- ` POST: /api/v1/auth/logout-all` - Logout all devices
- ` PUT: /api/v1/auth/change-password` - Change password
- ` GET: /api/v1/auth/me` - Get current user profile

### User APIs

- ` GET: /api/v1/user` - get all users (Admin only)
- ` PUT: /api/v1/user/profile` - Update user profile
- ` DELETE: /api/v1/user/account` - Delete user account
- ` DELETE: /api/v1/user/:id` - Delete user by ID (Admin only)

## ğŸ”€ Authentication Flow

1. **Registration/Login:** User provides credentials
2. **Token Generation:** Server generates access token (15mins) and refresh token (30d)
3. **Token Storage:** Refresh token stored as httpOnly cookie, access token returned in response
4. **API Access:** Include access token in Authorization header: `Bearer <access token>`
5. **Token Refresh:** When access token expires, use refresh endpoint with httpOnly cookie
6. **Logout:** Clear refresh token from database and cookie

## ğŸ” Security Features

- **Password Hashing:** bcrypt with salt rounds
- **JWT Tokens:** Separate access and refresh tokens
- **HttpOnly Cookies:** Refresh tokens stored securely
- **Rate Limiting:** 60 requests per minute per IP
- **CORS:** Configurable origin whitelist
- **Helmet:** Security headers
- **Input Validation:** Zod schema validation
- **Error Handling:** Centralized error handling with logging

## ğŸ‘¤ Role-Based Access Control

- **USER:** Basic user permissions
- **MODERATOR:** User + moderation permission
- **ADMIN:** Full system access

Use middleware to protect routes

```typescript
// Require authentication
router.use(authenticateToken)

// Require admin role
router.get("/admin-only", requireAdmin, controller)

// Require moderator or admin
router.get("/mod-only", requireModeratorOrAdmin, controller)
```

## ğŸš€ Production Deployment

### 1. Environment Variables

```env
NODE_ENV=production
DATABASE_URL=your-production-database-url
ACCESS_TOKEN_SECRET=your-production-access-secret
REFRESH_TOKEN_SECRET=your-production-refresh-secret
FRONTEND_URL=https://your-frontend-domain.com
```

### 2. Build and Start

```bash
npm run build
npm start
```

### ğŸ¬ Scripts

- `npm run dev` - Start development server with hot reload
- `npm run build` - Build for production
- `npm start` - Start production server
- `npm run prisma:generate` - Generate Prisma client
- `npm run migrate:dev` - Run database migrations in development mode
- `npm run migrate:prod` - Run database migrations in production mode
- `npm run db:seed` - Seed database with test data

## âš ï¸ Error Handling

The API uses centralized error handling with appropriate HTTP status codes:

- `400` - Bad Request (validation errors)
- `401` - Unauthorized (authentication required)
- `403` - Forbidden (insufficient permissions)
- `404` - Not Found
- `409` - Conflict (resource already exists)
- `500` - Internal Server Error

## ğŸ“ƒ Logging

Winston logger with different levels:

- **Development:** Console + file logging
- **Production:** File logging only
- **Log Files:** `logs/errors.log`, `logs/combined.log`

## Database Migrations

Add new migration:

```bash
npx prisma migrate dev --name add_new_feature
```

Reset database:

```bash
npx prisma migrate reset
```

## Contributing

1.  Follow TypeScript and ESLint rules
2.  Use function-based approach (no classes)
3.  Add proper error handling
4.  Include input validation
5.  Add logging for important operations
6.  Update documentation

## ğŸ™‹â€â™‚ï¸ Questions?

If you have any questions, feel free to open an issue or reach out on [GitHub Issues](https://github.com/NattX28/ts-nodejs-prisma-boilerplate/issues)
